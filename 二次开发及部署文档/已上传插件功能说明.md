# 黄埔海关智能运维平台 - 已上传插件功能说明

## 文档概述

本文档详细说明了当前系统中已上传的插件包及各个采集器的功能和作用。

**文档日期**: 2025-10-21
**系统环境**: 黄埔海关智能运维平台（基于 BlueKing Lite）

---

## 一、插件包概览

### 1.1 已上传的包

当前系统中已上传了一个融合采集器包，包含了控制器和多个采集器：

| 序号 | 包类型 | 操作系统 | 包对象 | 版本 | 包名称 | 说明 |
|------|--------|----------|--------|------|--------|------|
| 1 | controller | linux | Controller | 1.0.0 | fusion-collectors-linux-amd64.zip | 控制器包 |
| 2 | collector | linux | Telegraf | 1.0.0 | fusion-collectors-linux-amd64.zip | 指标采集器 |
| 3 | collector | linux | Vector | 1.0.0 | fusion-collectors-linux-amd64.zip | 日志采集器 |
| 4 | collector | linux | NATS-Executor | 1.0.0 | fusion-collectors-linux-amd64.zip | 命令执行器 |
| 5 | collector | linux | Metricbeat | 1.0.0 | fusion-collectors-linux-amd64.zip | Elastic 指标采集器 |
| 6 | collector | linux | Filebeat | 1.0.0 | fusion-collectors-linux-amd64.zip | Elastic 日志采集器 |
| 7 | collector | linux | Packetbeat | 1.0.0 | fusion-collectors-linux-amd64.zip | 网络数据包采集器 |
| 8 | collector | linux | Auditbeat | 1.0.0 | fusion-collectors-linux-amd64.zip | 审计数据采集器 |

**包大小**: 132MB
**存储位置**: MinIO S3 (linux/Controller/1.0.0/fusion-collectors-linux-amd64.zip)

### 1.2 包结构

```
fusion-collectors/
├── collector-sidecar         # Sidecar 控制器主程序（13MB）
├── sidecar.yml              # Sidecar 配置文件
├── sidecar.service          # Systemd 服务文件
├── install.sh               # 安装脚本
├── uninstall.sh             # 卸载脚本
├── bin/                     # 采集器二进制文件目录
│   ├── telegraf             # Telegraf 采集器（287MB）
│   ├── vector               # Vector 采集器（135MB）
│   ├── nats-executor        # NATS 执行器（10.6MB）
│   ├── filebeat/            # Filebeat 相关文件
│   ├── metricbeat/          # Metricbeat 相关文件
│   ├── packetbeat/          # Packetbeat 相关文件
│   └── auditbeat/           # Auditbeat 相关文件
├── generated/               # 动态生成的配置文件目录
├── cache/                   # 缓存目录
└── log/                     # 日志目录
```

---

## 二、控制器功能说明

### 2.1 Collector Sidecar（采集器边车）

**作用**: 核心控制器，负责管理和协调所有采集器的运行。

**主要功能**:
- **采集器生命周期管理**: 启动、停止、重启各个采集器进程
- **配置管理**: 接收服务器下发的配置，动态生成采集器配置文件
- **状态上报**: 定期向服务器上报节点状态、采集器运行状态
- **通信桥梁**: 作为节点与平台服务器之间的通信代理
- **文件缓存**: 管理采集器配置和数据的本地缓存

**配置文件**: `/opt/fusion-collectors/sidecar.yml`

**关键配置项**:
```yaml
server_url: "平台服务器地址"
server_api_token: "认证令牌"
node_id: "节点唯一标识"
update_interval: 10  # 状态更新间隔（秒）
collector_configuration_directory: "/opt/fusion-collectors/generated"
```

**运行方式**: 作为 systemd 服务持续运行

---

## 三、采集器功能详解

系统目前配置了 **27 种采集器**，涵盖了指标采集、日志采集、网络监控、审计监控等多个领域。

### 3.1 核心基础采集器

#### 3.1.1 Telegraf（指标采集器）

**类型**: 通用指标采集器
**二进制大小**: 287MB
**可执行文件**: `/opt/fusion-collectors/bin/telegraf`

**主要功能**:
- **系统指标采集**: CPU、内存、磁盘、网络等基础指标
- **中间件监控**: 支持数百种插件，覆盖各类中间件
- **自定义指标**: 支持自定义脚本和插件
- **多种输出**: 支持多种数据输出格式和协议

**适用场景**:
- 服务器基础资源监控
- 中间件性能监控
- 应用性能指标采集
- 自定义业务指标采集

#### 3.1.2 Vector（日志和事件采集器）

**类型**: 高性能日志/事件处理器
**二进制大小**: 135MB
**可执行文件**: `/opt/fusion-collectors/bin/vector`

**主要功能**:
- **日志采集**: 从文件、syslog、journald 等源采集日志
- **数据转换**: 对日志进行解析、过滤、聚合等处理
- **高性能**: Rust 编写，性能优异，资源占用低
- **多种输出**: 支持 Elasticsearch、Kafka、S3 等多种输出

**适用场景**:
- 应用日志采集
- 系统日志采集
- 日志实时处理和转换
- 日志路由和分发

#### 3.1.3 NATS-Executor（命令执行器）

**类型**: 远程命令执行器
**二进制大小**: 10.6MB
**可执行文件**: `/opt/fusion-collectors/bin/nats-executor`

**主要功能**:
- **远程命令执行**: 接收平台通过 NATS 消息队列下发的命令
- **SSH 操作**: 在目标主机上执行 SSH 命令
- **异步任务**: 支持长时间运行的异步任务
- **结果回传**: 将执行结果回传给平台

**适用场景**:
- 批量命令执行
- 自动化运维操作
- 脚本分发执行
- 配置文件下发

**支持系统**: Linux 和 Windows

---

### 3.2 Elastic Stack 采集器系列

#### 3.2.1 Metricbeat（指标采集器）

**可执行文件**: `/opt/fusion-collectors/bin/metricbeat/metricbeat`

**主要功能**:
- **系统指标**: 采集操作系统级别的性能指标
- **服务指标**: 采集各类服务（如 Apache、Nginx、MySQL）的性能指标
- **轻量级**: 资源占用少，适合大规模部署
- **Elastic 集成**: 与 Elasticsearch 和 Kibana 无缝集成

**监控模块**:
- System: CPU、内存、网络、进程等
- Docker: 容器和镜像指标
- Kubernetes: K8s 集群指标
- Redis、MySQL、MongoDB 等中间件

#### 3.2.2 Filebeat（日志采集器）

**可执行文件**: `/opt/fusion-collectors/bin/filebeat/filebeat`

**主要功能**:
- **日志文件采集**: 监控和采集指定的日志文件
- **日志转发**: 将日志发送到 Elasticsearch、Logstash 或 Kafka
- **多行日志处理**: 支持堆栈跟踪等多行日志
- **轻量高效**: 内存占用小，适合大量主机部署

**支持日志类型**:
- 应用日志（如 Nginx、Apache 访问日志）
- 系统日志（syslog、auth.log 等）
- 审计日志
- 自定义应用日志

#### 3.2.3 Packetbeat（网络数据包采集器）

**可执行文件**: `/opt/fusion-collectors/bin/packetbeat/packetbeat`

**主要功能**:
- **网络协议分析**: 实时分析网络数据包
- **应用层协议监控**: HTTP、HTTPS、MySQL、Redis 等协议
- **性能监控**: 请求响应时间、错误率等
- **网络流量分析**: 了解服务间通信情况

**支持协议**:
- HTTP/HTTPS
- MySQL、PostgreSQL
- Redis、MongoDB
- DNS、ICMP
- TLS

**适用场景**:
- 应用性能监控（APM）
- 网络流量分析
- 服务依赖关系分析
- 网络故障诊断

#### 3.2.4 Auditbeat（审计数据采集器）

**可执行文件**: `/opt/fusion-collectors/bin/auditbeat/auditbeat`

**主要功能**:
- **文件完整性监控**: 监控关键文件和目录的变化
- **审计日志采集**: 采集 Linux auditd 审计日志
- **系统调用监控**: 监控进程、用户、文件操作等
- **合规审计**: 满足安全合规要求

**监控内容**:
- 文件创建、修改、删除
- 用户登录、权限变更
- 系统服务启停
- 网络连接

**适用场景**:
- 安全审计
- 合规检查
- 入侵检测
- 配置变更跟踪

---

### 3.3 数据库监控采集器

#### 3.3.1 MySQL-Exporter

**可执行文件**: `/opt/fusion-collectors/bin/mysql_exporter`

**主要功能**:
- **MySQL 性能指标**: 查询性能、连接数、缓存命中率等
- **InnoDB 指标**: 事务、锁、缓冲池等
- **复制状态**: 主从复制延迟、状态监控
- **慢查询统计**: 慢查询数量和分布

**关键指标**:
- 连接数（当前/最大/使用率）
- 查询 QPS/TPS
- 缓冲池命中率
- 锁等待情况
- 主从复制延迟

#### 3.3.2 PostgreSQL-Exporter

**可执行文件**: `/opt/fusion-collectors/bin/postgres_exporter`

**主要功能**:
- **数据库性能监控**: 查询性能、连接池状态
- **表和索引统计**: 表大小、索引使用情况
- **复制监控**: 流复制状态和延迟
- **锁监控**: 死锁和锁等待情况

#### 3.3.3 MongoDB-Exporter

**可执行文件**: `/opt/fusion-collectors/bin/mongodb_exporter`

**主要功能**:
- **MongoDB 性能指标**: 操作计数、内存使用
- **副本集监控**: 副本集状态、同步延迟
- **分片集群监控**: 分片平衡、迁移状态
- **连接池监控**: 连接数和池状态

#### 3.3.4 Oracle-Exporter

**可执行文件**: `/opt/fusion-collectors/bin/oracle_exporter`

**主要功能**:
- **Oracle 数据库监控**: 会话、表空间、等待事件
- **性能指标**: SQL 执行统计、缓存命中率
- **RAC 监控**: Oracle RAC 集群监控

#### 3.3.5 MSSQL-Exporter

**可执行文件**: `/opt/fusion-collectors/bin/mssql_exporter`

**主要功能**:
- **SQL Server 监控**: 连接数、事务、锁
- **数据库文件监控**: 数据文件和日志文件使用情况
- **Always On 监控**: 可用性组状态监控

#### 3.3.6 Elasticsearch-Exporter

**可执行文件**: `/opt/fusion-collectors/bin/elasticsearch_exporter`

**主要功能**:
- **集群健康监控**: 集群状态、节点状态
- **索引性能**: 索引速率、查询速率
- **资源使用**: JVM 内存、线程池使用情况

---

### 3.4 中间件监控采集器

#### 3.4.1 Nginx-Exporter

**可执行文件**: `/opt/fusion-collectors/bin/nginx_exporter`

**主要功能**:
- **请求统计**: 总请求数、活动连接数
- **状态监控**: 2xx、3xx、4xx、5xx 响应统计
- **性能指标**: 请求处理时间、带宽使用

#### 3.4.2 Apache-Exporter

**可执行文件**: `/opt/fusion-collectors/bin/apache_exporter`

**主要功能**:
- **Apache 性能监控**: 请求数、工作进程状态
- **连接监控**: 当前连接数、空闲工作线程
- **流量统计**: 总流量、平均请求大小

#### 3.4.3 RabbitMQ-Exporter

**可执行文件**: `/opt/fusion-collectors/bin/rabbitmq_exporter`

**主要功能**:
- **队列监控**: 队列长度、消息堆积
- **消费者监控**: 消费速率、消费者数量
- **集群监控**: 节点状态、集群分区

#### 3.4.4 Kafka-Exporter

**可执行文件**: `/opt/fusion-collectors/bin/kafka_exporter`

**主要功能**:
- **消费组监控**: 消费延迟、消费进度
- **主题监控**: 分区数、副本状态
- **Broker 监控**: 消息速率、网络流量

#### 3.4.5 Zookeeper-Exporter

**可执行文件**: `/opt/fusion-collectors/bin/zookeeper_exporter`

**主要功能**:
- **ZooKeeper 状态监控**: 节点状态、Leader 选举
- **性能指标**: 延迟、吞吐量
- **连接监控**: 客户端连接数

---

### 3.5 Java 应用服务器监控（JMX 系列）

所有 JMX 监控器通过 Java JMX 协议采集 Java 应用的运行指标。

**可执行文件**: `/usr/bin/java`（需要 Java 运行环境）

#### 已配置的 JMX 监控器：

1. **JVM-JMX**: Java 虚拟机通用监控
   - JVM 内存（堆、非堆、各内存区域）
   - 垃圾回收统计
   - 线程数、类加载

2. **Tomcat-JMX**: Apache Tomcat 监控
   - 连接池状态
   - Servlet 性能
   - 会话管理

3. **JBoss-JMX**: Red Hat JBoss 应用服务器监控

4. **WebLogic-JMX**: Oracle WebLogic 服务器监控

5. **Jetty-JMX**: Eclipse Jetty 服务器监控

6. **TongWeb6-JMX**: 东方通 TongWeb 6 监控

7. **TongWeb7-JMX**: 东方通 TongWeb 7 监控

8. **ActiveMQ-JMX**: Apache ActiveMQ 消息中间件监控
   - 队列和主题统计
   - 消息积压
   - 连接和会话

---

## 四、采集器工作原理

### 4.1 整体架构

```
┌─────────────────────────────────────────────────┐
│          黄埔海关智能运维平台（服务器端）        │
│  ┌──────────────────────────────────────────┐  │
│  │  配置管理 │ 数据存储 │ 告警管理 │ 可视化  │  │
│  └──────────────────────────────────────────┘  │
└────────────────────┬────────────────────────────┘
                     │ HTTP/NATS
                     │
         ┌───────────▼──────────────┐
         │  Collector Sidecar       │  ← 控制器
         │  (采集器管理器)          │
         └───┬──────────────────┬───┘
             │                  │
    ┌────────▼─────┐    ┌──────▼────────┐
    │  采集器 A    │    │   采集器 B     │
    │ (Telegraf)   │    │  (Filebeat)    │
    └────┬─────────┘    └───────┬────────┘
         │                      │
    ┌────▼─────────────────────▼────┐
    │      目标系统/应用/服务        │
    │   (数据库/中间件/操作系统等)   │
    └────────────────────────────────┘
```

### 4.2 工作流程

1. **配置下发**:
   - 平台管理员在 Web 界面配置采集任务
   - 服务器将配置推送到目标节点的 Sidecar

2. **配置生成**:
   - Sidecar 接收配置后，生成对应采集器的配置文件
   - 配置文件存放在 `/opt/fusion-collectors/generated/` 目录

3. **采集器启动**:
   - Sidecar 根据配置启动相应的采集器进程
   - 采集器按照配置从目标系统采集数据

4. **数据上报**:
   - 采集器将数据发送到平台服务器
   - 数据存储到时序数据库（如 VictoriaMetrics）或日志系统

5. **状态监控**:
   - Sidecar 定期检查采集器运行状态
   - 向服务器上报节点和采集器状态

---

## 五、采集器部署和管理

### 5.1 安装流程

1. **上传包**: 管理员通过平台界面上传采集器包到系统
2. **选择目标**: 选择需要安装采集器的目标主机
3. **配置参数**: 配置主机连接信息（IP、SSH 用户名密码等）
4. **推送安装**: 平台自动将包推送到目标主机并执行安装脚本
5. **自动注册**: 安装完成后，节点自动注册到平台

**安装目录**: `/opt/fusion-collectors/`

### 5.2 配置管理

采集器配置通过平台统一管理：

1. **模板管理**: 在平台定义采集器配置模板
2. **参数化配置**: 使用变量和模板语法，支持动态配置
3. **版本控制**: 配置变更有版本记录，支持回滚
4. **批量下发**: 支持批量修改和下发配置

### 5.3 监控和维护

- **状态监控**: 实时查看采集器运行状态（运行中/已停止/异常）
- **日志查看**: 查看采集器运行日志，排查问题
- **远程操作**: 支持远程启动、停止、重启采集器
- **升级管理**: 支持采集器版本升级

---

## 六、应用场景

### 6.1 基础设施监控

**使用采集器**: Telegraf、Metricbeat

**监控内容**:
- 服务器 CPU、内存、磁盘、网络
- 操作系统进程、服务状态
- 硬件健康状态

### 6.2 数据库监控

**使用采集器**: MySQL-Exporter、PostgreSQL-Exporter、Oracle-Exporter 等

**监控内容**:
- 数据库性能指标
- 连接池状态
- 慢查询统计
- 主从复制状态

### 6.3 中间件监控

**使用采集器**: Nginx-Exporter、RabbitMQ-Exporter、Kafka-Exporter 等

**监控内容**:
- Web 服务器请求统计
- 消息队列积压情况
- 缓存命中率
- 连接池状态

### 6.4 应用监控

**使用采集器**: JVM-JMX、Tomcat-JMX、Packetbeat

**监控内容**:
- JVM 内存和 GC
- 应用线程池
- HTTP 请求响应时间
- 应用性能指标

### 6.5 日志采集

**使用采集器**: Filebeat、Vector、Auditbeat

**采集内容**:
- 应用日志（访问日志、错误日志、业务日志）
- 系统日志（syslog、auth 日志）
- 审计日志（文件变更、用户操作）
- 安全日志（登录失败、权限变更）

### 6.6 网络监控

**使用采集器**: Packetbeat

**监控内容**:
- 网络协议流量分析
- 服务间调用关系
- API 性能监控
- 网络故障诊断

### 6.7 自动化运维

**使用采集器**: NATS-Executor

**应用场景**:
- 批量命令执行
- 脚本自动化分发
- 配置文件统一下发
- 应用部署和更新

---

## 七、采集器对比

### 7.1 指标采集器对比

| 采集器 | 特点 | 资源占用 | 扩展性 | 推荐场景 |
|--------|------|----------|--------|----------|
| **Telegraf** | 插件丰富，功能全面 | 中等 | ★★★★★ | 通用指标采集 |
| **Metricbeat** | 轻量，Elastic 生态 | 低 | ★★★★ | Elastic Stack 用户 |
| **Exporter 系列** | 专用性强，开箱即用 | 低 | ★★★ | 特定中间件监控 |

### 7.2 日志采集器对比

| 采集器 | 特点 | 性能 | 功能 | 推荐场景 |
|--------|------|------|------|----------|
| **Vector** | 高性能，功能强大 | ★★★★★ | ★★★★★ | 大规模日志采集 |
| **Filebeat** | 轻量，简单易用 | ★★★★ | ★★★ | Elastic Stack 集成 |

---

## 八、最佳实践建议

### 8.1 采集器选择建议

1. **基础监控**:
   - Linux 服务器: Telegraf 或 Metricbeat
   - Windows 服务器: Telegraf

2. **数据库监控**:
   - 使用对应的 Exporter（如 MySQL-Exporter）
   - 配合 Telegraf 采集系统级别指标

3. **日志采集**:
   - 大规模场景: Vector（性能更好）
   - Elastic Stack 环境: Filebeat（生态集成更好）

4. **Java 应用**:
   - 使用对应的 JMX 监控器
   - 配合 Telegraf 采集 JVM 指标

5. **网络监控**:
   - 使用 Packetbeat 进行应用性能监控
   - 配合 Telegraf 采集网卡流量

6. **安全审计**:
   - 使用 Auditbeat 监控文件完整性
   - 配合 Filebeat 采集审计日志

### 8.2 性能优化建议

1. **合理配置采集间隔**:
   - 基础指标: 30-60 秒
   - 应用性能: 10-30 秒
   - 关键业务: 5-10 秒

2. **减少不必要的采集项**:
   - 只采集需要的指标
   - 关闭不使用的插件

3. **使用本地缓存**:
   - 网络故障时缓存数据
   - 避免数据丢失

4. **批量发送数据**:
   - 配置合理的批次大小
   - 减少网络开销

### 8.3 监控覆盖建议

推荐为不同类型的主机安装以下采集器组合：

**Linux 应用服务器**:
- ✅ Telegraf（系统和应用指标）
- ✅ Filebeat 或 Vector（日志）
- ✅ NATS-Executor（远程管理）

**数据库服务器**:
- ✅ Telegraf（系统指标）
- ✅ 对应的数据库 Exporter
- ✅ Filebeat（数据库日志）
- ✅ NATS-Executor

**Web 服务器**:
- ✅ Telegraf（系统指标）
- ✅ Nginx/Apache Exporter
- ✅ Filebeat（访问日志、错误日志）
- ✅ Packetbeat（应用性能）

**Java 应用服务器**:
- ✅ Telegraf（系统和 JVM 指标）
- ✅ 对应的 JMX 监控器（如 Tomcat-JMX）
- ✅ Filebeat（应用日志）

---

## 九、技术参数

### 9.1 系统要求

**最低配置**:
- CPU: 1 核
- 内存: 512MB（基础采集）
- 磁盘: 1GB 可用空间

**推荐配置**:
- CPU: 2 核及以上
- 内存: 2GB 及以上
- 磁盘: 10GB 可用空间（用于日志缓存）

### 9.2 网络要求

- **出站连接**: 需要能访问平台服务器（HTTP/HTTPS）
- **NATS 连接**: NATS-Executor 需要连接 NATS 服务器
- **数据传输**: 根据采集量规划带宽（一般 1-10 Mbps）

### 9.3 支持的操作系统

- **Linux**:
  - CentOS/RHEL 7/8/9
  - Ubuntu 18.04/20.04/22.04
  - Debian 9/10/11
  - 银河麒麟 V10 SP3
  - 统信 UOS

- **Windows**: 部分采集器支持（NATS-Executor 有 Windows 版本）

---

## 十、常见问题

### Q1: 如何查看采集器运行状态？

**A**:
1. 登录平台 Web 界面
2. 进入"节点管理"模块
3. 查看节点详情，可以看到各采集器的运行状态

或者在主机上执行：
```bash
systemctl status collector-sidecar
cd /opt/fusion-collectors
./collector-sidecar status
```

### Q2: 采集器日志在哪里？

**A**:
- Sidecar 日志: `/opt/fusion-collectors/log/sidecar.log`
- 各采集器日志: `/opt/fusion-collectors/log/{collector_name}.log`

### Q3: 如何手动启动/停止采集器？

**A**:
通过平台界面操作（推荐），或在主机上：
```bash
# 通过 Sidecar 管理
cd /opt/fusion-collectors
./collector-sidecar restart {collector_name}

# 或通过 systemd
systemctl restart collector-sidecar
```

### Q4: 采集器配置文件在哪里？

**A**:
- Sidecar 配置: `/opt/fusion-collectors/sidecar.yml`
- 动态生成的采集器配置: `/opt/fusion-collectors/generated/`

**注意**: 不要手动修改 generated 目录下的配置，这些配置由 Sidecar 根据平台下发的配置自动生成。

### Q5: 如何卸载采集器？

**A**:
通过平台界面执行卸载操作，或在主机上执行：
```bash
cd /opt/fusion-collectors
sudo bash ./uninstall.sh
```

### Q6: 采集器占用资源过高怎么办？

**A**:
1. 检查采集间隔，适当延长采集周期
2. 减少不必要的采集项
3. 检查是否有采集器故障导致频繁重试
4. 查看日志排查异常

---

## 十一、总结

当前系统已上传的 **fusion-collectors-linux-amd64.zip** 包是一个功能全面的融合采集器套件，包含了：

✅ **1 个核心控制器** (Collector Sidecar)
✅ **4 个基础采集器** (Telegraf、Vector、NATS-Executor、Metricbeat)
✅ **3 个 Elastic 采集器** (Filebeat、Packetbeat、Auditbeat)
✅ **7 个数据库监控器** (MySQL、PostgreSQL、MongoDB、Oracle、MSSQL、Elasticsearch、Zookeeper)
✅ **5 个中间件监控器** (Nginx、Apache、RabbitMQ、Kafka、Zookeeper)
✅ **8 个 Java 应用监控器** (JVM、Tomcat、JBoss、WebLogic、Jetty、TongWeb、ActiveMQ 等)

这套采集器体系能够覆盖：
- 🖥️ 操作系统和硬件监控
- 💾 数据库性能监控
- 🌐 Web 服务和中间件监控
- ☕ Java 应用监控
- 📝 日志采集和分析
- 🔒 安全审计和合规
- 🌍 网络性能监控
- 🤖 自动化运维

**适用于黄埔海关的全栈智能运维监控需求。**

---

**文档维护**: 运维团队
**联系方式**: 如有问题请联系平台管理员
**文档版本**: v1.0
