# 本地开发环境搭建记录

**日期**: 2025-10-19
**维护者**: superfm
**目的**: 为 Blueking Lite 项目搭建本地开发环境，并创建便捷的管理脚本

---

## 一、完成的工作

### 1.1 创建的核心文件

| 文件路径 | 用途 |
|---------|------|
| `dev.sh` | 统一开发环境管理脚本（启动/停止/日志/数据库管理）|
| `docker-compose.dev.yml` | 本地开发基础设施 Docker Compose 配置 |
| `server/.env.dev` | Server 后端环境变量模板 |
| `web/.env.local.dev` | Web 前端环境变量模板 |
| `DEVELOPMENT.md` | 完整的开发环境使用文档 |
| `CLAUDE.md` | AI 助手项目指导文件 |

### 1.2 修改的文件

| 文件 | 修改内容 |
|-----|---------|
| `.gitignore` | 添加开发临时文件忽略规则 |

---

## 二、dev.sh 管理脚本功能

### 2.1 核心命令

```bash
# 环境管理
./dev.sh check                # 检查开发环境
./dev.sh install              # 安装所有依赖

# 服务管理
./dev.sh start [all|infra|server|web]    # 启动服务
./dev.sh stop [all|infra|server|web]     # 停止服务
./dev.sh restart [all|infra|server|web]  # 重启服务
./dev.sh status                           # 查看状态
./dev.sh logs [infra|server|web]         # 查看日志

# 数据库管理
./dev.sh db init      # 初始化数据库
./dev.sh db migrate   # 运行迁移
./dev.sh db shell     # 数据库 Shell
./dev.sh db reset     # 重置数据库

# Git 管理
./dev.sh git-setup    # 配置 Git 凭证
./dev.sh git-push     # 提交并推送
```

---

## 三、基础设施服务

### 3.1 Docker Compose 服务列表

| 服务 | 镜像 | 端口 | 用途 |
|-----|------|------|------|
| postgres | postgres:15-alpine | 5432 | 主数据库 |
| redis | redis:7-alpine | 6379 | 缓存/Celery |
| minio | minio/minio | 9000, 9001 | 对象存储 |
| nats | nats:latest | 4222, 8222 | 消息队列 |
| victoria-metrics | victoriametrics/victoria-metrics | 8428 | 监控数据 |
| victoria-logs | victoriametrics/victoria-logs | 9428 | 日志存储 |
| falkordb | falkordb/falkordb | 6479 | 图数据库 |
| mlflow | ghcr.io/mlflow/mlflow | 5000 | ML 跟踪 |

### 3.2 默认账号密码

| 服务 | 用户名 | 密码 |
|-----|--------|------|
| PostgreSQL | postgres | bklite_dev_pass |
| Redis | - | bklite_redis_pass |
| MinIO | minioadmin | minioadmin123 |
| FalkorDB | - | bklite_falkordb_pass |
| BKLite 管理员 | admin | password |

---

## 四、快速开始

### 4.1 首次使用完整流程

```bash
# 1. 检查环境
./dev.sh check

# 2. 安装依赖（需要先安装 uv 和 Python 3.12+）
./dev.sh install

# 3. 启动基础设施
./dev.sh start infra

# 4. 初始化数据库
./dev.sh db init

# 5. 启动所有服务
./dev.sh start all

# 6. 查看状态
./dev.sh status
```

### 4.2 访问地址

- **Web 前端**: http://localhost:3000
- **Server API**: http://localhost:8001
- **MinIO 控制台**: http://localhost:9001
- **MLflow**: http://localhost:5000

---

## 五、测试结果

### 5.1 环境检查

```
✓ Docker: 28.4.0
✓ Docker Compose: 2.39.4
✓ Node.js: v22.12.0
✓ pnpm: 10.12.1
⚠ Python: 3.8 (需要 3.12+)
✗ uv: 未安装
```

### 5.2 基础设施启动测试

所有服务成功启动：
- ✅ PostgreSQL (healthy)
- ✅ Redis (healthy)
- ✅ MinIO (healthy)
- ✅ FalkorDB (healthy)
- ✅ NATS
- ✅ Victoria Metrics
- ✅ Victoria Logs

---

## 六、后续步骤

### 6.1 环境准备（必需）

1. **安装 Python 3.12+**
   ```bash
   # 使用 pyenv
   curl https://pyenv.run | bash
   pyenv install 3.12
   pyenv local 3.12
   ```

2. **安装 uv**
   ```bash
   curl -LsSf https://astral.sh/uv/install.sh | sh
   ```

3. **安装依赖**
   ```bash
   ./dev.sh install
   ```

### 6.2 完整启动

```bash
./dev.sh start all
```

---

## 七、相关文档

- **开发环境完整指南**: `DEVELOPMENT.md`
- **AI 助手指引**: `CLAUDE.md`
- **项目 README**: `Readme.md`

---

## 八、总结

✅ 创建了统一的开发环境管理脚本
✅ 配置了完整的 Docker Compose 基础设施
✅ 编写了详细的开发文档
✅ 测试验证了基础设施服务
✅ 更新了 AI 助手指导文件

开发者现在可以通过简单的命令快速搭建和管理本地开发环境！

---

**最后更新**: 2025-10-19
